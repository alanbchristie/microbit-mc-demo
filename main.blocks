<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="[SJFfiJI~v2!!|?[PDCs">reading</variable><variable id="v9-+8)O5HHSWx^3NKdi{">voltage-now</variable><variable id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</variable><variable id="gF)cz/oK/+KZyUsu*G1#">connected-voltage</variable><variable id="oV+sA9aef5c9ivk/fD$-">voltage-threshold-good</variable><variable id="~WQ#Y/~q_[*c1%//2cN2">idle-count</variable><variable id="|3(nGc1n4|^%%V=U@CQr">idle-clear-threshold</variable><variable id="_(rAX`[)mSI4m,K6%L!0">pin-0-at-1v</variable></variables><comment id="!Q(RB@_5Y(Bf|1/)jk~S" x="0" y="28" h="486.22222900390625" w="475.33331298828125">"Hands-Free Battery Tester"&#10;...for AA Alkaline batteries&#10;&#10;A main-loop that monitors the analogue value on PIN-0 every few seconds. When it looks like a voltage is applied (i.e. anything above 0.5V) it displays either a "smile" or "frown" depending on the condition.&#10;&#10;A voltage greater than 1.35V (voltage-threshold-good') is used to indicate a "healthy" battery.&#10;&#10;The indication is "held" for a few seconds when the battery is removed.&#10;&#10;A "pull-down" resistor between PIN-0 and GND is required for this to work otherwise PIN-0 floats, typically to 3V. The example uses a 1M-ohm resistor - large enough to pull PIN-0 to ground but large enough not draw any significant current from the attached battery.</comment><block type="device_forever" id="mS%,s}1~!z+KcnGhy#k3" x="520" y="26"><statement name="HANDLER"><block type="device_pause" id=")tZ5U1jh[`Kvy|u-:]*)"><value name="pause"><shadow type="timePicker" id="Mdw?.p{$J4{3D,~W,5pk"><field name="ms">2000</field></shadow></value><next><block type="variables_set" id="/y-(+5(iZJu{{N%x`K2q"><field name="VAR" id="v9-+8)O5HHSWx^3NKdi{">voltage-now</field><value name="VALUE"><shadow type="math_number" id=",dabvh:yYv;arTag`A.E"><field name="NUM">0</field></shadow><block type="function_call_output" id="j7)oI4N)Oh6U|i,t43{."><mutation name="get-voltage" functionid="D}zw/oTD0LGEHk~^d}~9"/></block></value><next><block type="controls_if" id="$Bq7jfNMv$e?ddL!9U.j"><mutation else="1"/><value name="IF0"><shadow type="logic_boolean" id="F?X1X#wGi.R?sd-aoKQT"><field name="BOOL">TRUE</field></shadow><block type="function_call_output" id="_hLYBCX7d3LC3|J~rF|q"><mutation name="is-connected" functionid="rwmj(WDr_L~@$KRy5M%j"><arg name="num" id="n*V-mG?bT@5dp9zd2g]:" type="number"/></mutation><value name="n*V-mG?bT@5dp9zd2g]:"><shadow type="math_number" id="Q.-}R++(I~:B2:#8~w4N"><field name="NUM">1</field></shadow><block type="variables_get" id="9XR(Uga@jXdEmTh6$DDr"><field name="VAR" id="v9-+8)O5HHSWx^3NKdi{">voltage-now</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="Yo/wz_(hDP9^;^1k4jNU"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field><value name="VALUE"><shadow type="math_number" id="yA`y?(d]R]*Stwm!~}G2"><field name="NUM">0</field></shadow><block type="function_call_output" id="Ge/7,A7I_p:}?9g`VgFb"><mutation name="set-peak" functionid="tOl2+p,?807H:7h*-3P8"><arg name="num" id="nYZUVl*MUNO2)q.~.0;6" type="number"/></mutation><value name="nYZUVl*MUNO2)q.~.0;6"><shadow type="math_number" id="^H(];.Hu2a3Y6Y@P4tUP"><field name="NUM">1</field></shadow><block type="variables_get" id="?^Q4j[bFvGF+!ux0eOk="><field name="VAR" id="v9-+8)O5HHSWx^3NKdi{">voltage-now</field></block></value></block></value><next><block type="controls_if" id="_*uR|lzQ@l}C`W|VJ]]-"><mutation else="1"/><value name="IF0"><shadow type="logic_boolean" id="[!vv!ae**VDfL5Kd]Mp#"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id=";Ru{s`]0|8a,lwq#|_gW"><field name="OP">GTE</field><value name="A"><shadow type="math_number" id="p*5-WQy|`:#h36*{]~Ua"><field name="NUM">0</field></shadow><block type="variables_get" id=":o#WdUIJ[PN`+Tx[{-*K"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field></block></value><value name="B"><shadow type="math_number" id="$`j2G$T=!B`W)C@7=QTm"><field name="NUM">0</field></shadow><block type="variables_get" id="P_Pl}Fn=5ufO7YQCr92?"><field name="VAR" id="oV+sA9aef5c9ivk/fD$-">voltage-threshold-good</field></block></value></block></value><statement name="DO0"><block type="function_call" id=",I:I*pXW;rgi5xrkU@-e"><mutation name="display-good" functionid=",{{#XiRi_?K++H*52d)Q"/></block></statement><statement name="ELSE"><block type="function_call" id="?y936Ay,F[9~`!7qF2C*"><mutation name="display-bad" functionid="ZN.Q#Ab}:wvt:P3;dB[n"/></block></statement><next><block type="controls_if" id="iXR?hbey4KlJeFv(BnG["><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="xddtH:+-MS[(osC2LoL8"><field name="OP">NEQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="w3[oPHGt3X-}wn@R-SXa"><field name="VAR" id="~WQ#Y/~q_[*c1%//2cN2">idle-count</field></block></value><value name="B"><shadow type="math_number" id="Ew]@*%1~b3=5UNZjjxMs"><field name="NUM">0</field></shadow></value></block></value><statement name="DO0"><block type="variables_set" id="SCo?j|pQ0UF(yF[6A9kO"><field name="VAR" id="~WQ#Y/~q_[*c1%//2cN2">idle-count</field><value name="VALUE"><shadow type="math_number" id="DN-tLmcPpnKGQj$VInze"><field name="NUM">0</field></shadow></value></block></statement></block></next></block></next></block></statement><statement name="ELSE"><block type="controls_if" id="`~~6`|C?[BXEd!)xvG#|"><value name="IF0"><shadow type="logic_boolean" id="*@JoSOR~~Zag^LsDP6X["><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="}NAXefqhGHIvt*`+Iij2"><field name="OP">NEQ</field><value name="A"><shadow type="math_number" id="zQz2Y]JO|,qPkTFRHe+Y"><field name="NUM">0</field></shadow><block type="variables_get" id="*Mv+,#a?8Z`C75-/HEzB"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field></block></value><value name="B"><shadow type="math_number" id="K6iy)(a87KtzUO1/!x9E"><field name="NUM">0</field></shadow></value></block></value><statement name="DO0"><block type="variables_set" id="0;W8**$yz{bH|Gf%T~_:"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field><value name="VALUE"><shadow type="math_number" id="uFdk96FbS0H5fTaAr7!Y"><field name="NUM">0</field></shadow></value></block></statement><next><block type="controls_if" id="goPu`UQp$a}/_hX7A4hX"><value name="IF0"><shadow type="logic_boolean" id="WI+%Pv*0rDZ?(gy?49gT"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="_YDyy3;NQIQS!!^4CxG;"><field name="OP">LT</field><value name="A"><shadow type="math_number" id="pmyPwze*8hND71Pc86IY"><field name="NUM">0</field></shadow><block type="variables_get" id=":?pWo%[_L{F$1`QAzG4R"><field name="VAR" id="~WQ#Y/~q_[*c1%//2cN2">idle-count</field></block></value><value name="B"><shadow type="math_number" id="uk_1e{J%%0N?M%qTK:)h"><field name="NUM">0</field></shadow><block type="variables_get" id="S]@t)_-/Hyw,gQt^Z51S"><field name="VAR" id="|3(nGc1n4|^%%V=U@CQr">idle-clear-threshold</field></block></value></block></value><statement name="DO0"><block type="variables_change" id="97NQ.TK#?e!s#}in1slu"><field name="VAR" id="~WQ#Y/~q_[*c1%//2cN2">idle-count</field><value name="VALUE"><shadow type="math_number" id="m{GB3rt9p(|VN(P@W|:+"><field name="NUM">1</field></shadow></value></block></statement><next><block type="controls_if" id="e)G+=jR4y|zcZ=/^ZK43"><value name="IF0"><shadow type="logic_boolean" id="`$PblX[1rM5_7DYG4fN8"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="{z@Dg}#Hps=BO4v*u=@|"><field name="OP">EQ</field><value name="A"><shadow type="math_number" id="iO`4!m.nP2WIdx.gq7r/"><field name="NUM">0</field></shadow><block type="variables_get" id="$v8|VMO#}$,G72xRSxmD"><field name="VAR" id="~WQ#Y/~q_[*c1%//2cN2">idle-count</field></block></value><value name="B"><shadow type="math_number" id="Ff_0;(Z[{dOD:QT1O)ND"><field name="NUM">5</field></shadow><block type="variables_get" id="5~CN0U?2e^gMG6*#r}*6"><field name="VAR" id="|3(nGc1n4|^%%V=U@CQr">idle-clear-threshold</field></block></value></block></value><statement name="DO0"><block type="function_call" id="6rmdjle)ZGP[{K^FLrTq"><mutation name="display-icon" functionid="r(-2r`hnmU!Wx=G)=C9L"/></block></statement></block></next></block></next></block></statement></block></next></block></next></block></statement></block><block type="function_definition" id="4T.DSaK$8:zP)$h)uj.0" x="1362" y="0"><mutation name="get-voltage" functionid="D}zw/oTD0LGEHk~^d}~9"/><field name="function_name">get-voltage</field><comment pinned="false" h="145.55555725097656" w="244.4444580078125">Reads the analogue value from PIN-0 and returns the "calibrated" voltage (a float)</comment><statement name="STACK"><block type="variables_set" id="QD1U{MbX6up5#i`1OR}@"><field name="VAR" id="[SJFfiJI~v2!!|?[PDCs">reading</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_analog_pin" id="m4;drPMsbs+2zYS=18Q?"><field name="name">AnalogPin.P0</field></block></value><next><block type="variables_set" id="XC^JBiA$=hqyJ#dgO8[7"><field name="VAR" id="v9-+8)O5HHSWx^3NKdi{">voltage-now</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="_`^e.5?flmg:E2p?BEN*"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="?K46Ua|]t2*3%RUW!R8!"><field name="NUM">0</field></shadow><block type="variables_get" id="PnIVG79L6w:MA02|PDo|"><field name="VAR" id="[SJFfiJI~v2!!|?[PDCs">reading</field></block></value><value name="B"><shadow type="math_number" id="k9|6a;XJ%AC*#F_24~P="><field name="NUM">311.5</field></shadow><block type="variables_get" id="1fbNPBTpfZmmH}yCPyLQ"><field name="VAR" id="_(rAX`[)mSI4m,K6%L!0">pin-0-at-1v</field></block></value></block></value><next><block type="function_return" id="%r^ck*Qb)Jr6CGh[[N(L"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><block type="variables_get" id="TSkNc,O9Gch2-c#;!`f2"><field name="VAR" id="v9-+8)O5HHSWx^3NKdi{">voltage-now</field></block></value></block></next></block></next></block></statement></block><block type="function_definition" id="Va3LrA1X+gL_h4,O0^?u" x="1363" y="309"><mutation name="is-connected" functionid="rwmj(WDr_L~@$KRy5M%j"><arg name="num" id="n*V-mG?bT@5dp9zd2g]:" type="number"/></mutation><field name="function_name">is-connected</field><comment pinned="false" h="136.66668701171875" w="256.6666259765625">Given a "calibrated" voltage this method returns true if the voltage is sufficient to consider that a battery is actually attached.</comment><value name="n*V-mG?bT@5dp9zd2g]:"><shadow type="argument_reporter_number" id="rBWAx:?M5;;Hc)U%N_5q"><field name="VALUE">num</field></shadow></value><statement name="STACK"><block type="controls_if" id="Mqf)uZan9ekk}}GV(A/s"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id=",dg-h1Tp8qUB:?P%{B=D"><field name="OP">GTE</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="argument_reporter_number" id=";N$C;c0PTGB{84ZH6![B"><field name="VALUE">num</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="9ds5gFi{Ov#~+A/PUr|s"><field name="VAR" id="gF)cz/oK/+KZyUsu*G1#">connected-voltage</field></block></value></block></value><statement name="DO0"><block type="function_return" id="UnR2{S..T))W^rdI;Y)("><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="logic_boolean" id="lgV^QO46[bUYA-1DK/#T"><field name="BOOL">TRUE</field></block></value></block></statement><next><block type="function_return" id="JM0G!VfiQ?mogwyDy*@U"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number" id="(/I8Jfg:k**weJNcIQt*"><field name="NUM">0</field></shadow><block type="logic_boolean" id="nm(!w?q$,+un7NMCS%Rl"><field name="BOOL">FALSE</field></block></value></block></next></block></statement></block><block type="pxt-on-start" id="s364K@]8hzYvxQ!UNw7|" x="2" y="556"><comment pinned="false" h="114.4444580078125" w="221.11114501953125">Initialises control variables and displays the application icon (a +/- symbol)</comment><statement name="HANDLER"><block type="variables_set" id="3lMP7GHvf7=7AXNvcD};"><field name="VAR" id="~WQ#Y/~q_[*c1%//2cN2">idle-count</field><value name="VALUE"><shadow type="math_number" id="qrw.v*){BO5D0:xIuvd/"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="KtQ9t7$vF]MLtv1p{q^*"><field name="VAR" id="|3(nGc1n4|^%%V=U@CQr">idle-clear-threshold</field><value name="VALUE"><shadow type="math_number" id="YIxFI2[@O71.G0Tygsg*"><field name="NUM">1</field></shadow></value><next><block type="variables_set" id="matOcm^bobal7I6lz3tF"><field name="VAR" id="gF)cz/oK/+KZyUsu*G1#">connected-voltage</field><value name="VALUE"><shadow type="math_number" id="TZMoxafK@JX^zAmM!ED^"><field name="NUM">0.5</field></shadow></value><next><block type="variables_set" id="U{w{a`-Anc#.^CKUN|$`"><field name="VAR" id="oV+sA9aef5c9ivk/fD$-">voltage-threshold-good</field><value name="VALUE"><shadow type="math_number" id="X|K-YN#,~`Du|V2|-#*o"><field name="NUM">1.35</field></shadow></value><next><block type="variables_set" id="UhByI=*?nu3wzr}.W{.c"><field name="VAR" id="_(rAX`[)mSI4m,K6%L!0">pin-0-at-1v</field><value name="VALUE"><shadow type="math_number" id="NxvGF{YEHwhFfdBrtgU-"><field name="NUM">311.5</field></shadow></value><next><block type="function_call" id="u4z:fi$)QEbw:0s(htjK"><mutation name="display-icon" functionid="r(-2r`hnmU!Wx=G)=C9L"/></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="EbH_*KWM*vEdswx55/uU" x="1360" y="645"><mutation name="set-peak" functionid="tOl2+p,?807H:7h*-3P8"><arg name="num" id="nYZUVl*MUNO2)q.~.0;6" type="number"/></mutation><field name="function_name">set-peak</field><comment pinned="false" h="80" w="160">Given a calibrated voltage this function returns the new peak value.</comment><value name="nYZUVl*MUNO2)q.~.0;6"><shadow type="argument_reporter_number" id="gq)-:$1)KoeZn_lN+F:n"><field name="VALUE">num</field></shadow></value><statement name="STACK"><block type="controls_if" id=":PU)Q5%88uld}]I$J[,!"><value name="IF0"><shadow type="logic_boolean" id="@UVY0:h;IRgK4{%Em7.-"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="_4Xz{|)1PI@./=z6(-(*"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="argument_reporter_number" id="cdo{3+F!9=2CMl:}W})D"><field name="VALUE">num</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="M^h^XMeDYS%9pj-ShM]q"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="0::QI_uRt`my#5GOr(Vv"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="}]Zx6-9U7hth2{CTo)A+"><field name="VAR" id="v9-+8)O5HHSWx^3NKdi{">voltage-now</field></block></value></block></statement><next><block type="function_return" id="-S$qH8)-%fBqxMvSL2,m"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number" id="MH7`R2%=Yx[hQ^EEfjR*"><field name="NUM">0</field></shadow><block type="variables_get" id="1;r[C}|Ye~^:6a{TNbYV"><field name="VAR" id=":#/#HR2GaE0*Xh/B:IsO">voltage-peak</field></block></value></block></next></block></statement></block><block type="function_definition" id="+,z~hcYU)ELJOolkD}nI" x="522" y="1210"><mutation name="display-icon" functionid="r(-2r`hnmU!Wx=G)=C9L"/><field name="function_name">display-icon</field><comment pinned="false" h="80" w="160">Displays the application icon (low luminosity)</comment><statement name="STACK"><block type="device_set_brightness" id="+LJVqU0u71KSi#M#6{Rq"><value name="value"><shadow type="math_number_minmax" id="O^!.0HArK!3Fd`QT:/u}"><mutation min="0" max="255" label="Value" precision="0"/><field name="SLIDER">16</field></shadow></value><next><block type="device_show_leds" id=",2._3mDI$m_#7SSyQRuG"><field name="LEDS">`&#10;        . . # . . &#10;        . # # # . &#10;        . . # . . &#10;        . . . . . &#10;        . # # # .&#10;        `</field></block></next></block></statement></block><block type="function_definition" id="Z)$I|=wj/8Zaxb7JxRda" x="879" y="1210"><mutation name="display-good" functionid=",{{#XiRi_?K++H*52d)Q"/><field name="function_name">display-good</field><comment pinned="false" h="127.77780151367188" w="220.00006103515625">Displays a "smiley face" - usually called when a battery of good condition is attached.</comment><statement name="STACK"><block type="device_set_brightness" id="L5j}I:(e.Dcswwx^]N[z"><value name="value"><shadow type="math_number_minmax" id="0rZJeqFK*6y=fc!%x)YW"><mutation min="0" max="255" label="Value" precision="0"/><field name="SLIDER">64</field></shadow></value><next><block type="basic_show_icon" id="B8H^{l*Wi}O}f/;)L_KO"><field name="i">IconNames.Happy</field></block></next></block></statement></block><block type="function_definition" id="ulp@1h,_E%Z%?K~3WQ`t" x="1241" y="1204"><mutation name="display-bad" functionid="ZN.Q#Ab}:wvt:P3;dB[n"/><field name="function_name">display-bad</field><comment pinned="false" h="132.22222900390625" w="250">Displays a "sad face" - usually called when a battery of poor condition is attached.</comment><statement name="STACK"><block type="device_set_brightness" id="BhW0;eIE8$bT}Uce?V_r"><value name="value"><shadow type="math_number_minmax" id="bT/x)Ybi0%/:QZC4v/-C"><mutation min="0" max="255" label="Value" precision="0"/><field name="SLIDER">64</field></shadow></value><next><block type="basic_show_icon" id=",9c-DHuu:UonmD,5$RKT"><field name="i">IconNames.Sad</field></block></next></block></statement></block></xml>